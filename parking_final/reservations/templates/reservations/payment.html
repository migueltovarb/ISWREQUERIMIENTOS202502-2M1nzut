{% extends 'reservations/base.html' %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Procesar Pago</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <strong>Resumen de la Reserva:</strong><br>
                    Parqueadero: {{ reservation.parking_lot.name }}<br>
                    Placa: {{ reservation.license_plate }}<br>
                    Horario: {{ reservation.start_time|date:"d/m/Y H:i" }} - {{ reservation.end_time|date:"d/m/Y H:i" }}<br>
                    <strong>Total a pagar: ${{ reservation.total_amount }}</strong>
                </div>
                
                {% if form.errors %}
                <div class="alert alert-danger">
                    <strong>Errores en el formulario:</strong>
                    <ul>
                        {% for field, errors in form.errors.items %}
                            {% for error in errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="mb-4">
                        <label class="form-label"><strong>M√©todo de Pago</strong></label>
                        <div class="border p-3 rounded">
                            {% for value, label in form.payment_method.field.choices %}
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="radio" name="payment_method" 
                                       value="{{ value }}" id="{{ value }}" 
                                       {% if form.payment_method.value == value %}checked{% endif %}>
                                <label class="form-check-label" for="{{ value }}">
                                    {{ label }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Campos para Tarjeta (inicialmente ocultos) -->
                    <div id="card-fields" class="border p-3 rounded mb-3" style="display: none;">
                        <h6>Datos de la Tarjeta</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">N√∫mero de Tarjeta</label>
                                <input type="text" class="form-control" name="card_number" 
                                       maxlength="16" placeholder="1234 5678 9012 3456">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nombre en la Tarjeta</label>
                                <input type="text" class="form-control" name="card_holder" 
                                       placeholder="JUAN PEREZ">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">Fecha Expiraci√≥n (MM/AA)</label>
                                <input type="text" class="form-control" name="expiry_date" 
                                       maxlength="5" placeholder="12/25">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label">CVV</label>
                                <input type="text" class="form-control" name="cvv" 
                                       maxlength="3" placeholder="123">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Campo para Billetera Digital (inicialmente oculto) -->
                    <div id="wallet-fields" class="border p-3 rounded mb-3" style="display: none;">
                        <h6>Datos de Billetera Digital</h6>
                        <div class="mb-3">
                            <label class="form-label">Token de Billetera</label>
                            <input type="text" class="form-control" name="wallet_token" 
                                   placeholder="Ingresa tu token de billetera digital">
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <button type="submit" class="btn btn-success btn-lg w-100">
                            üí≥ Pagar ${{ reservation.total_amount }}
                        </button>
                        <a href="{% url 'parking_list' %}" class="btn btn-outline-secondary mt-2 w-100">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
// Mostrar/ocultar campos seg√∫n el m√©todo de pago seleccionado
document.addEventListener('DOMContentLoaded', function() {
    const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
    const cardFields = document.getElementById('card-fields');
    const walletFields = document.getElementById('wallet-fields');
    
    function toggleFields() {
        const selectedMethod = document.querySelector('input[name="payment_method"]:checked');
        
        // Ocultar todos los campos primero
        cardFields.style.display = 'none';
        walletFields.style.display = 'none';
        
        // Mostrar campos seg√∫n el m√©todo seleccionado
        if (selectedMethod) {
            if (selectedMethod.value === 'credit_card' || selectedMethod.value === 'debit_card') {
                cardFields.style.display = 'block';
            } else if (selectedMethod.value === 'digital_wallet') {
                walletFields.style.display = 'block';
            }
        }
    }
    
    // Agregar evento a cada radio button
    paymentMethods.forEach(radio => {
        radio.addEventListener('change', toggleFields);
    });
    
    // Ejecutar al cargar la p√°gina por si hay un m√©todo seleccionado
    toggleFields();
});
</script>
{% endblock %}